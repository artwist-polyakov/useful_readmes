# üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis —Å n8n: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é `n8n`. –û–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **Redis** –¥–ª—è –¥–≤—É—Ö –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–¥–∞—á:

1.  **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–º–æ–≥–æ n8n.
2.  **–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö:** –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –≤–∞—à–∏—Ö –≤–æ—Ä–∫—Ñ–ª–æ—É.

---

## üê≥ 1. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Redis

–≠—Ç–æ—Ç —à–∞–≥ —è–≤–ª—è–µ—Ç—Å—è –æ–±—â–∏–º –¥–ª—è –æ–±–æ–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. Redis –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç–æ–π –∂–µ Docker-—Å–µ—Ç–∏ `n8n-net`, —á—Ç–æ –∏ n8n, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Redis, –≥–¥–µ –æ–Ω –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
mkdir -p ~/redis_data
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Redis:

```bash
docker run -d \
  --name redis \
  --restart unless-stopped \
  --network n8n-net \
  -v ~/redis_data:/data \
  redis:latest redis-server --save 60 1 --loglevel warning
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
* `--name redis`: –ó–∞–¥–∞–µ–º –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É `redis`. –ü–æ —ç—Ç–æ–º—É –∏–º–µ–Ω–∏ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å–µ—Ç–∏ `n8n-net` —Å–º–æ–≥—É—Ç –∫ –Ω–µ–º—É –æ–±—Ä–∞—â–∞—Ç—å—Å—è.
* `--network n8n-net`: –ü–æ–¥–∫–ª—é—á–∞–µ–º Redis –∫ –Ω–∞—à–µ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Ç–∏.
* `-v ~/redis_data:/data`: –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–Ω–∞–ø—à–æ—Ç–æ–≤) Redis.
* `redis-server --save 60 1`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Redis. –ì–æ–≤–æ—Ä–∏–º –µ–º—É —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫ (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –ø–∞–ø–∫—É `/data`, –∫–æ—Ç–æ—Ä–∞—è —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ `~/redis_data` –Ω–∞ —Ö–æ—Å—Ç–µ), –µ—Å–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥ –±—ã–ª–æ —Ö–æ—Ç—è –±—ã 1 –∏–∑–º–µ–Ω–µ–Ω–∏–µ. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±—ç–∫–∞–ø–æ–≤.

---

## ‚öôÔ∏è 2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ Redis –∑–∞–ø—É—â–µ–Ω, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å n8n –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º.

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è n8n

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–≤—ã—à–∞–µ—Ç –æ–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å n8n, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—É—Å–∫–æ–≤. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä n8n:**

```bash
docker stop n8n
docker rm n8n
```

**2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ n8n —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è Redis:**

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É `docker run` –¥–ª—è n8n —Å–ª–µ–¥—É—é—â–∏–µ `-e` —Ñ–ª–∞–≥–∏:

```bash
docker run -d --restart unless-stopped \
  --name n8n \
  --network n8n-net \
  -p 5678:5678 \
  # ... –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ...
  -e N8N_HOST="n8n.–≤–∞—à-–¥–æ–º–µ–Ω.ru" \
  -e WEBHOOK_TUNNEL_URL="[https://n8n.–≤–∞—à-–¥–æ–º–µ–Ω.ru/](https://n8n.–≤–∞—à-–¥–æ–º–µ–Ω.ru/)" \
  \
  # ----- –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –∫—ç—à–∞ -----
  -e CACHE_ENABLED=true \
  -e CACHE_TYPE=redis \
  -e CACHE_REDIS_HOST=redis \
  # ---------------------------------------------
  \
  n8nio/n8n
```

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis –∏–∑ –≤–æ—Ä–∫—Ñ–ª–æ—É (–∫–∞–∫ Credentials)

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–¥—ã `Redis` –≤ —Å–≤–æ–∏—Ö –≤–æ—Ä–∫—Ñ–ª–æ—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ –∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ API-–∑–∞–ø—Ä–æ—Å–æ–≤).

**–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è n8n –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.** –ü—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Redis –∏–∑ —à–∞–≥–∞ 1 –∑–∞–ø—É—â–µ–Ω.

**–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ n8n:**

1.  –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ n8n –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Credentials` –∏ –Ω–∞–∂–º–∏—Ç–µ `Add credential`.
2.  –ù–∞–π–¥–∏—Ç–µ `Redis` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ.
3.  –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
    * **Credential Name:** –î–∞–π—Ç–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, `–õ–æ–∫–∞–ª—å–Ω—ã–π Redis`.
    * **Host:** `redis` (—ç—Ç–æ –∏–º—è –Ω–∞—à–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Docker-—Å–µ—Ç–∏).
    * **Port:** `6379` (–ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
    * –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (User, Password) –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º–∏, —Ç–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.
4.  –ù–∞–∂–º–∏—Ç–µ **Save**.

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∫—Ä–µ–¥—ã –≤ –ª—é–±–æ–π –Ω–æ–¥–µ `Redis` –≤ –≤–∞—à–∏—Ö –≤–æ—Ä–∫—Ñ–ª–æ—É.

---

## üíæ 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Redis –≤ —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞

–ß—Ç–æ–±—ã —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤–∫–ª—é—á–∞–ª–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –±–∞–∑—É n8n, –Ω–æ –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Redis, –æ–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞.

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
sudo nano /usr/local/bin/n8n-backup.sh
```

–ü—Ä–∏–≤–µ–¥–∏—Ç–µ –µ–≥–æ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É:

```bash
#!/bin/bash

# –ü–∞–ø–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –±—ç–∫–∞–ø–∏—Ç—å
N8N_DATA_DIR="$HOME/n8n_data"
REDIS_DATA_DIR="$HOME/redis_data"
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Postgres, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏ –µ–≥–æ –¥–∞–º–ø
# POSTGRES_BACKUP_FILE="$HOME/n8n_backups/postgres_dump_$(date +%F).sql"

BACKUP_DIR="$HOME/n8n_backups"
BACKUP_FILE="$BACKUP_DIR/n8n-full-backup-$(date +%F-%H%M%S).tar.gz"

# –°–æ–∑–¥–∞–µ–º –¥–∞–º–ø Postgres (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# docker exec postgres pg_dumpall -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å > "$POSTGRES_BACKUP_FILE"

echo "[$(date)] Creating full backup..."

# –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
# –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ -C: –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
tar -czf "$BACKUP_FILE" \
    -C "$HOME" "n8n_data" \
    -C "$HOME" "redis_data"
    # -C "$HOME/n8n_backups" "$(basename $POSTGRES_BACKUP_FILE)" # –î–æ–±–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –¥–µ–ª–∞–µ—Ç–µ –¥–∞–º–ø PG

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7)
ls -1t "$BACKUP_DIR"/n8n-full-backup-*.tar.gz | tail -n +8 | xargs -r rm --

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –¥–∞–º–ø Postgres (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# rm "$POSTGRES_BACKUP_FILE"

echo "[$(date)] Backup created: $BACKUP_FILE"
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç —É–ø–∞–∫–æ–≤—ã–≤–∞—Ç—å –∏ –¥–∞–Ω–Ω—ã–µ n8n, –∏ –¥–∞–Ω–Ω—ã–µ Redis –≤ –æ–¥–∏–Ω –∞—Ä—Ö–∏–≤.

